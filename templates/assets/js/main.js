document.addEventListener("DOMContentLoaded",()=>{const html=document.documentElement;const moonIcon=document.getElementById("theme-dark");const sunIcon=document.getElementById("theme-light");const toggle=moonIcon?.closest("button")||sunIcon?.closest("button");if(!html||!toggle||!moonIcon||!sunIcon)return;const getCurrentTheme=()=>html.getAttribute("data-color-scheme")==="dark";const setTheme=isDark=>{if(isDark){html.setAttribute("data-color-scheme","dark")}else{html.removeAttribute("data-color-scheme")}localStorage.setItem("theme",isDark?"dark":"light")};const savedTheme=localStorage.getItem("theme");const initialDark=savedTheme==="dark"||getCurrentTheme();if(initialDark){sunIcon.classList.add("hidden");moonIcon.classList.remove("hidden");moonIcon.classList.remove("opacity-0","rotate-90","-rotate-90","scale-50");moonIcon.classList.add("opacity-100","rotate-0","scale-100")}else{moonIcon.classList.add("hidden");sunIcon.classList.remove("hidden");sunIcon.classList.remove("opacity-0","rotate-90","-rotate-90","scale-50");sunIcon.classList.add("opacity-100","rotate-0","scale-100")}setTheme(initialDark);toggle.addEventListener("click",()=>{const currentTheme=getCurrentTheme();const newTheme=!currentTheme;setTheme(newTheme);const currentSunIcon=document.getElementById("theme-light");const currentMoonIcon=document.getElementById("theme-dark");if(newTheme){currentSunIcon.classList.remove("opacity-100","rotate-0","scale-100");currentSunIcon.classList.add("opacity-0","-rotate-90","scale-50");setTimeout(()=>{currentSunIcon.classList.add("hidden");currentMoonIcon.classList.remove("hidden");currentMoonIcon.offsetHeight;currentMoonIcon.classList.remove("opacity-100","rotate-0","scale-100");currentMoonIcon.classList.add("opacity-0","rotate-90","scale-50");requestAnimationFrame(()=>{currentMoonIcon.classList.remove("opacity-0","rotate-90","scale-50");currentMoonIcon.classList.add("opacity-100","rotate-0","scale-100")})},150)}else{currentMoonIcon.classList.remove("opacity-100","rotate-0","scale-100");currentMoonIcon.classList.add("opacity-0","rotate-90","scale-50");setTimeout(()=>{currentMoonIcon.classList.add("hidden");currentSunIcon.classList.remove("hidden");const sunIconClone=currentSunIcon.cloneNode(true);currentSunIcon.parentNode.replaceChild(sunIconClone,currentSunIcon);const newSunIcon=document.getElementById("theme-light");newSunIcon.offsetHeight;newSunIcon.classList.remove("opacity-100","rotate-0","scale-100");newSunIcon.classList.add("opacity-0","-rotate-90","scale-50");requestAnimationFrame(()=>{newSunIcon.classList.remove("opacity-0","-rotate-90","scale-50");newSunIcon.classList.add("opacity-100","rotate-0","scale-100")})},150)}})});document.addEventListener("DOMContentLoaded",()=>{const menuToggle=document.getElementById("mobile-menu-toggle");let menuIcon=document.getElementById("mobile-menu-icon");let isMenuOpen=false;if(!menuToggle||!menuIcon)return;const staticMenuIconSVG=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19"/></svg>`;const menuIconSVG=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19"><animate fill="freeze" attributeName="d" dur="0.4s" values="M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19;M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19"/></path></svg>`;const xIconSVG=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19"><animate fill="freeze" attributeName="d" dur="0.4s" values="M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19;M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19"/></path></svg>`;const initSVG=()=>{const tempDiv=document.createElement("div");tempDiv.innerHTML=staticMenuIconSVG;const newSVG=tempDiv.firstElementChild;newSVG.id="mobile-menu-icon";newSVG.className="h-6 w-6";menuIcon.parentNode.replaceChild(newSVG,menuIcon);menuIcon=document.getElementById("mobile-menu-icon")};initSVG();menuToggle.addEventListener("click",()=>{isMenuOpen=!isMenuOpen;const newSVGHTML=isMenuOpen?menuIconSVG:xIconSVG;const tempDiv=document.createElement("div");tempDiv.innerHTML=newSVGHTML;const newSVG=tempDiv.firstElementChild;newSVG.id="mobile-menu-icon";newSVG.className="h-6 w-6";menuIcon.parentNode.replaceChild(newSVG,menuIcon);menuIcon=document.getElementById("mobile-menu-icon");if(menuIcon){menuIcon.offsetHeight}})});class Upvote{constructor(storageKey,plural,apiEndpoint="/apis/api.halo.run/v1alpha1/trackers/upvote",group="content.halo.run"){this.storageKey=storageKey;this.plural=plural;this.apiEndpoint=apiEndpoint;this.group=group;this.liked=[];this.processing=false}init(){this.liked=JSON.parse(localStorage.getItem(this.storageKey)||"[]");document.addEventListener("click",this.handleClick.bind(this));this.liked.forEach(itemName=>this.setLikedState(itemName))}handleClick(e){const btn=e.target.closest(".upvote-btn");if(!btn)return;e.preventDefault();e.stopPropagation();const itemName=btn.dataset.articleName||btn.dataset.pageName;if(itemName)this.click(itemName)}async click(itemName){if(this.liked.includes(itemName)||this.processing)return;this.processing=true;try{const response=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:this.group,plural:this.plural,name:itemName})});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);this.liked.push(itemName);localStorage.setItem(this.storageKey,JSON.stringify(this.liked));this.updateUI(itemName)}catch(err){console.error("ÁÇπËµûÂ§±Ë¥•ÔºåËØ∑ÈáçËØï:",err)}finally{this.processing=false}}setLikedState(itemName){this.updateButtonState(itemName)}updateUI(itemName){const countEl=document.querySelector(`[data-upvote-post-name="${itemName}"], [data-upvote-page-name="${itemName}"]`);if(countEl){const currentCount=parseInt(countEl.textContent)||0;countEl.textContent=currentCount+1}this.updateButtonState(itemName)}updateButtonState(itemName){const btn=document.querySelector(`.upvote-btn[data-article-name="${itemName}"], .upvote-btn[data-page-name="${itemName}"]`);if(btn){btn.disabled=true;btn.classList.add("cursor-not-allowed");const svg=btn.querySelector("svg");if(svg){svg.outerHTML=`<svg class="h-3.5 w-3.5 md:h-4.5 md:w-4.5" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="currentColor">\n          <path d="M667.786667 117.333333C832.864 117.333333 938.666667 249.706667 938.666667 427.861333c0 138.250667-125.098667 290.506667-371.573334 461.589334a96.768 96.768 0 0 1-110.186666 0C210.432 718.368 85.333333 566.112 85.333333 427.861333 85.333333 249.706667 191.136 117.333333 356.213333 117.333333c59.616 0 100.053333 20.832 155.786667 68.096C567.744 138.176 608.170667 117.333333 667.786667 117.333333z" fill="#ed4832"/>\n        </svg>`}}}}document.addEventListener("DOMContentLoaded",()=>{const hasArticleButton=document.querySelector("[data-article-name]");const hasPageButton=document.querySelector("[data-page-name]");if(hasArticleButton){const postUpvote=new Upvote("halo.upvoted.post.names","posts");postUpvote.init()}if(hasPageButton){const pageUpvote=new Upvote("halo.upvoted.singlepage.names","singlepages");pageUpvote.init()}});(function(){const savedTheme=localStorage.getItem("theme");const prefersDark=window.matchMedia("(prefers-color-scheme: dark)").matches;const shouldUseDark=savedTheme==="dark"||savedTheme===null&&prefersDark;if(shouldUseDark){document.documentElement.setAttribute("data-color-scheme","dark")}else{document.documentElement.removeAttribute("data-color-scheme")}})();console.log("üì¶ [dev-build] Ê≠£Âú®ÊûÑÂª∫ main.js...");
