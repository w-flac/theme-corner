document.addEventListener("DOMContentLoaded",()=>{const html=document.documentElement;const moonIcon=document.getElementById("theme-dark");const sunIcon=document.getElementById("theme-light");const toggle=moonIcon?.closest("button")||sunIcon?.closest("button");if(!html||!toggle||!moonIcon||!sunIcon)return;const getCurrentTheme=()=>html.getAttribute("data-color-scheme")==="dark";const setTheme=isDark=>{if(isDark){html.setAttribute("data-color-scheme","dark")}else{html.removeAttribute("data-color-scheme")}localStorage.setItem("theme",isDark?"dark":"light")};const savedTheme=localStorage.getItem("theme");const initialDark=savedTheme==="dark"||getCurrentTheme();if(initialDark){sunIcon.classList.add("hidden");moonIcon.classList.remove("hidden");moonIcon.classList.remove("opacity-0","rotate-90","-rotate-90","scale-50");moonIcon.classList.add("opacity-100","rotate-0","scale-100")}else{moonIcon.classList.add("hidden");sunIcon.classList.remove("hidden");sunIcon.classList.remove("opacity-0","rotate-90","-rotate-90","scale-50");sunIcon.classList.add("opacity-100","rotate-0","scale-100")}setTheme(initialDark);toggle.addEventListener("click",()=>{const currentTheme=getCurrentTheme();const newTheme=!currentTheme;setTheme(newTheme);const currentSunIcon=document.getElementById("theme-light");const currentMoonIcon=document.getElementById("theme-dark");if(newTheme){currentSunIcon.classList.remove("opacity-100","rotate-0","scale-100");currentSunIcon.classList.add("opacity-0","-rotate-90","scale-50");setTimeout(()=>{currentSunIcon.classList.add("hidden");currentMoonIcon.classList.remove("hidden");currentMoonIcon.offsetHeight;currentMoonIcon.classList.remove("opacity-100","rotate-0","scale-100");currentMoonIcon.classList.add("opacity-0","rotate-90","scale-50");requestAnimationFrame(()=>{currentMoonIcon.classList.remove("opacity-0","rotate-90","scale-50");currentMoonIcon.classList.add("opacity-100","rotate-0","scale-100")})},150)}else{currentMoonIcon.classList.remove("opacity-100","rotate-0","scale-100");currentMoonIcon.classList.add("opacity-0","rotate-90","scale-50");setTimeout(()=>{currentMoonIcon.classList.add("hidden");currentSunIcon.classList.remove("hidden");const sunIconClone=currentSunIcon.cloneNode(true);currentSunIcon.parentNode.replaceChild(sunIconClone,currentSunIcon);const newSunIcon=document.getElementById("theme-light");newSunIcon.offsetHeight;newSunIcon.classList.remove("opacity-100","rotate-0","scale-100");newSunIcon.classList.add("opacity-0","-rotate-90","scale-50");requestAnimationFrame(()=>{newSunIcon.classList.remove("opacity-0","-rotate-90","scale-50");newSunIcon.classList.add("opacity-100","rotate-0","scale-100")})},150)}})});document.addEventListener("DOMContentLoaded",()=>{const menuToggle=document.getElementById("mobile-btn");const menuPanel=document.getElementById("mobile-menu-panel");const iconBar=document.getElementById("icon-bar");const iconClose=document.getElementById("icon-close");if(!menuToggle)return;const openMenu=()=>{document.body.classList.add("overflow-hidden");menuPanel.classList.remove("pointer-events-none");menuPanel.classList.add("pointer-events-auto");menuPanel.offsetHeight;menuPanel.classList.remove("opacity-0","scale-95");menuPanel.classList.add("opacity-100","scale-100");const hideMenu=event=>{if(!menuToggle.contains(event.target)&&!menuPanel.contains(event.target)){closeMenu();document.removeEventListener("click",hideMenu)}};setTimeout(()=>{document.addEventListener("click",hideMenu)},100)};const closeMenu=()=>{document.body.classList.remove("overflow-hidden");menuPanel.classList.remove("opacity-100","scale-100");menuPanel.classList.add("opacity-0","scale-95");setTimeout(()=>{menuPanel.classList.remove("pointer-events-auto");menuPanel.classList.add("pointer-events-none")},200)};menuToggle.addEventListener("click",()=>{const isHidden=menuPanel.classList.contains("pointer-events-none");if(isHidden){iconBar.classList.add("hidden");iconClose.classList.remove("hidden");openMenu()}else{iconBar.classList.remove("hidden");iconClose.classList.add("hidden");closeMenu()}})});class Upvote{constructor(storageKey,plural,apiEndpoint="/apis/api.halo.run/v1alpha1/trackers/upvote",group="content.halo.run"){this.storageKey=storageKey;this.plural=plural;this.apiEndpoint=apiEndpoint;this.group=group;this.liked=[];this.processing=false}init(){this.liked=JSON.parse(localStorage.getItem(this.storageKey)||"[]");document.addEventListener("click",this.handleClick.bind(this));this.liked.forEach(itemName=>this.setLikedState(itemName))}handleClick(e){const btn=e.target.closest(".upvote-btn");if(!btn)return;e.preventDefault();e.stopPropagation();const itemName=btn.dataset.articleName||btn.dataset.pageName;if(itemName)this.click(itemName)}async click(itemName){if(this.liked.includes(itemName)||this.processing)return;this.processing=true;try{const response=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:this.group,plural:this.plural,name:itemName})});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);this.liked.push(itemName);localStorage.setItem(this.storageKey,JSON.stringify(this.liked));this.updateUI(itemName)}catch(err){console.error("ÁÇπËµûÂ§±Ë¥•ÔºåËØ∑ÈáçËØï:",err)}finally{this.processing=false}}setLikedState(itemName){this.updateButtonState(itemName)}updateUI(itemName){const countEl=document.querySelector(`[data-upvote-post-name="${itemName}"], [data-upvote-page-name="${itemName}"]`);if(countEl){const currentCount=parseInt(countEl.textContent)||0;countEl.textContent=currentCount+1}this.updateButtonState(itemName)}updateButtonState(itemName){const btn=document.querySelector(`.upvote-btn[data-article-name="${itemName}"], .upvote-btn[data-page-name="${itemName}"]`);if(btn){btn.disabled=true;btn.classList.add("cursor-not-allowed");const svg=btn.querySelector("svg");if(svg){svg.outerHTML=`<svg class="size-5" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="currentColor">\n          <path d="M667.786667 117.333333C832.864 117.333333 938.666667 249.706667 938.666667 427.861333c0 138.250667-125.098667 290.506667-371.573334 461.589334a96.768 96.768 0 0 1-110.186666 0C210.432 718.368 85.333333 566.112 85.333333 427.861333 85.333333 249.706667 191.136 117.333333 356.213333 117.333333c59.616 0 100.053333 20.832 155.786667 68.096C567.744 138.176 608.170667 117.333333 667.786667 117.333333z" fill="#ed4832"/>\n        </svg>`}}}}document.addEventListener("DOMContentLoaded",()=>{const hasArticleButton=document.querySelector("[data-article-name]");const hasPageButton=document.querySelector("[data-page-name]");if(hasArticleButton){const postUpvote=new Upvote("halo.upvoted.post.names","posts");postUpvote.init()}if(hasPageButton){const pageUpvote=new Upvote("halo.upvoted.singlepage.names","singlepages");pageUpvote.init()}});(function(){const savedTheme=localStorage.getItem("theme");const prefersDark=window.matchMedia("(prefers-color-scheme: dark)").matches;const shouldUseDark=savedTheme==="dark"||savedTheme===null&&prefersDark;if(shouldUseDark){document.documentElement.setAttribute("data-color-scheme","dark")}else{document.documentElement.removeAttribute("data-color-scheme")}})();console.log("üì¶ [dev-build] Ê≠£Âú®ÊûÑÂª∫ main.js...");function toggleMenu(button){const menu=document.getElementById("children-"+button.id);if(!menu)return;const isHidden=menu.classList.contains("pointer-events-none");if(isHidden){menu.classList.remove("pointer-events-none","opacity-0","translate-y-1");menu.classList.add("pointer-events-auto","opacity-100","translate-y-0");const hideMenu=event=>{if(!button.contains(event.target)&&!menu.contains(event.target)){menu.classList.add("pointer-events-none","opacity-0","translate-y-1");menu.classList.remove("pointer-events-auto","opacity-100","translate-y-0");document.removeEventListener("click",hideMenu)}};document.addEventListener("click",hideMenu)}else{menu.classList.add("pointer-events-none","opacity-0","translate-y-1");menu.classList.remove("pointer-events-auto","opacity-100","translate-y-0")}}
